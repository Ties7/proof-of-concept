{% render 'partials/head.liquid', title: 'Funda' %}

{% include 'partials/nav-version-2.liquid' %}

<div class="gallery-container">

    {% comment %} <form class="like-container" action="/like" method="POST" data-enhanced="form-{{ house.id }}">
        <input type="hidden" name="houseid" value="{{ house.id }}">
        <button type="submit" class="like-button">
            "0"
            <p>Bewaren</p>
        </button>
    </form> {% endcomment %}

    <div class="gallery-wrapper">

        <div class="btn-wrapper">
            <button class="share-btn">
                <p class="share-icon">
                    <svg width="20" height="20" viewBox="0 0 18 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M15.0003 13.8954C14.0526 13.8962 13.1609 14.3448 12.5953 15.1054L5.84035 11.2054C6.03815 10.6271 6.05212 10.0019 5.88035 9.41538L12.7303 5.46038C13.7173 6.6041 15.4006 6.83559 16.6596 6.00071C17.9186 5.16583 18.3605 3.52504 17.6909 2.17086C17.0214 0.816677 15.4494 0.171577 14.0216 0.665097C12.5938 1.15862 11.7557 2.63679 12.0653 4.11538L5.12035 8.11538C3.9612 6.95729 2.08728 6.94348 0.911183 8.08434C-0.264916 9.22521 -0.308083 11.0987 0.814221 12.2925C1.93652 13.4863 3.80909 13.5588 5.02035 12.4554L12.0203 16.5004C11.8559 17.7385 12.4757 18.9489 13.5764 19.5392C14.6771 20.1295 16.0283 19.976 16.9687 19.154C17.909 18.332 18.2417 17.0134 17.8039 15.8437C17.366 14.674 16.2493 13.8979 15.0003 13.8954ZM15.0003 2.00538C15.8288 2.00538 16.5003 2.67695 16.5003 3.50538C16.5003 4.3338 15.8288 5.00538 15.0003 5.00538C14.1719 5.00538 13.5003 4.3338 13.5003 3.50538C13.5003 2.67695 14.1719 2.00538 15.0003 2.00538ZM3.00035 11.7454C2.17192 11.7454 1.50035 11.0738 1.50035 10.2454C1.50035 9.41695 2.17192 8.74538 3.00035 8.74538C3.82878 8.74538 4.50035 9.41695 4.50035 10.2454C4.50035 11.0738 3.82878 11.7454 3.00035 11.7454ZM15.0003 18.3954C14.1719 18.3954 13.5003 17.7238 13.5003 16.8954C13.5003 16.0669 14.1719 15.3954 15.0003 15.3954C15.8288 15.3954 16.5003 16.0669 16.5003 16.8954C16.5003 17.7238 15.8288 18.3954 15.0003 18.3954Z" fill="#0071B3"/>
                    </svg>
                </p>
            </button>
        
            <button class="like-button" data-liked="{{ liked }}">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 512 512">
                    <path class="heart" d="M256 448a32 32 0 0 1-18-5.57c-78.59-53.35-112.62-89.93-131.39-112.8c-40-48.75-59.15-98.8-58.61-153C48.63 114.52 98.46 64 159.08 64c44.08 0 74.61 24.83 92.39 45.51a6 6 0 0 0 9.06 0C278.31 88.81 308.84 64 352.92 64c60.62 0 110.45 50.52 111.08 112.64c.54 54.21-18.63 104.26-58.61 153c-18.77 22.87-52.8 59.45-131.39 112.8a32 32 0 0 1-18 5.56" stroke-width="40"/>
                </svg>
                <p>Bewaren</p>
            </button>
        </div>
        
        <div class="gallery show-all">
            <button class="gallery-item">
                <img src="https://fdnd-agency.directus.app/assets/{{ house.poster_image }}?format=avif&width=300&height=250" loading="lazy" />
            </button>
            {% for asset in house.gallery %}
                <button class="gallery-item">
                    <img src="https://fdnd-agency.directus.app/assets/{{ asset.directus_files_id }}?format=avif&width=300&height=250" loading="lazy" />
                </button>
            {% endfor %}
        </div>

    <section class="details-short-container">
        <h2>{{ house.street }} {{ house.house_nr }}</h2>
        <p>{{ house.postal_code }} {{ house.city }}</p>
    </section>

    </div>

    
</div>

<dialog class="detail-modal">
    <div class="detail-container">
        <div class="detail-bar detail-bar-top">
            <form method="dialog">
                <button class="carousel-close-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" role="presentation" viewBox="0 0 48 48" class="m-2 size-[32px] text-neutral-50 lg:m-1 lg:size-11"><path d="M26.12 24l10.61-10.61a1.5 1.5 0 000-2.12 1.5 1.5 0 00-2.12 0L24 21.88 13.39 11.27a1.5 1.5 0 10-2.12 2.12L21.88 24 11.27 34.61a1.5 1.5 0 102.12 2.12L24 26.12l10.61 10.61a1.5 1.5 0 002.12 0 1.5 1.5 0 000-2.12z"></path></svg></button>
            </form>
        </div>

        <div class="carousel">
            <button class="carousel-btn left" alt="button left">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8.2201 11.465L13.5001 6.17004C13.6423 6.03756 13.8303 5.96544 14.0246 5.96887C14.2189 5.9723 14.4043 6.05101 14.5417 6.18842C14.6791 6.32583 14.7578 6.51122 14.7613 6.70552C14.7647 6.89982 14.6926 7.08787 14.5601 7.23004L9.8151 12L14.5851 16.77C14.7257 16.9139 14.8033 17.1077 14.801 17.3089C14.7986 17.51 14.7165 17.702 14.5726 17.8425C14.4287 17.9831 14.2349 18.0608 14.0338 18.0584C13.8326 18.0561 13.6407 17.9739 13.5001 17.83L8.2351 12.545C8.09555 12.4029 8.01736 12.2117 8.01736 12.0125C8.01736 11.8134 8.09555 11.6222 8.2351 11.48L8.2201 11.465Z" fill="white"/>
                </svg>
            </button>
            <button class="carousel-btn right" alt="button right">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15.7799 11.465L10.4999 6.17004C10.3577 6.03756 10.1697 5.96544 9.97538 5.96887C9.78107 5.9723 9.59569 6.05101 9.45828 6.18842C9.32086 6.32583 9.24215 6.51122 9.23872 6.70552C9.23529 6.89982 9.30742 7.08787 9.4399 7.23004L14.1849 12L9.4149 16.77C9.27433 16.9139 9.19668 17.1077 9.19903 17.3089C9.20137 17.51 9.28352 17.702 9.4274 17.8425C9.57128 17.9831 9.7651 18.0608 9.96624 18.0584C10.1674 18.0561 10.3593 17.9739 10.4999 17.83L15.7649 12.545C15.9045 12.4029 15.9826 12.2117 15.9826 12.0125C15.9826 11.8134 15.9045 11.6222 15.7649 11.48L15.7799 11.465Z" fill="white"/>
                </svg>
            </button>

            <figure class="carousel-item">
                <img class="carousel-img" src="https://fdnd-agency.directus.app/assets/{{ house.poster_image }}?format=avif&width=300&height=200" loading="lazy" />
            </figure>
            {% for asset in house.gallery %}
                <figure class="carousel-item">
                    <img class="carousel-img" src="https://fdnd-agency.directus.app/assets/{{ asset.directus_files_id }}?format=avif&width=300&height=200" loading="lazy" />
                </figure>
            {% endfor %}
        </div>

        <div class="detail-bar">
            <span class="carousel-nav-label">1 / 5</span>
        </div>
    </div>
</dialog>

<script defer src="/scripts/detail-page.js"></script>

{% render 'partials/foot.liquid' %}

<style>
    .like-button {
        display: flex;
        flex-direction: row;
        align-items: center;
        padding: .6rem;
        gap: .5rem;
        z-index: 10;
        background-color: none;
        border: none;
        border-radius: .2rem;
        cursor: pointer;

        p {
            color: #0071B3;
            font-size: 16px;
        }
    }

    .like-button[data-liked=true] {
        background-color: rgb(255, 255, 255);
        
        .heart {
            /* stroke: #0071B3; */
            fill: #0071B3;
            transform-origin: center;
            animation: move .4s ease-in-out;
        }
    }

    @keyframes move {
        0% {
            scale: 90%;
            transform: rotate(0deg);
        }

        33% {
            scale: 100%;
            transform: rotate(-30deg);
        }

        66% {
            transform: rotate(30deg);
        }

        100% {
            transform: rotate(0deg);
        }
    }
    
    .like-button[data-liked=false] {
        background-color: rgb(255, 255, 255);
        
        .heart {
            stroke: #0071B3;
            fill: none;
            transform-origin: center;
            animation: move-in .2s ease-in-out;
        }
    }

    @keyframes move-in {
        0% {
            scale: 80%;
        }
        
        100% {
            scale: 100%;
        }
    }


    .like-button:disabled {
        .heart {
            transform-origin: center;
            animation: move-out .7s ease-in-out infinite;
        }
    }

    @keyframes move-out {
        0% {
            scale: 100%;
        }
        
        100% {
            scale: 80%;
        }
    }

    .share-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: .6rem;
        gap: .5rem;
        z-index: 10;
        background-color: none;
        border: none;
        border-radius: .2rem;
        cursor: pointer;

        background-color: white;
    }

    .share-icon svg {
        display: block;
    }

    .btn-wrapper {
        position: absolute;
        right: .9rem;
        top: .9rem;
        display: flex;
        flex-direction: row;
        gap: .5rem;
    }

</style>
<script defer>
    // like
    const likeButton = document.querySelector(".like-button");
    
    likeButton.addEventListener("click", async function() {
        // als data-liked van de button true is: het huis is geliked
        const isLiked = likeButton.dataset.liked === "true";

        // maak knop tijdelijk disabled
        likeButton.disabled = true;

        // maak request naar 'like' of 'unlike' afhankelijk van huidige like status
        const url = isLiked ? "unlike" : "like";
        const request = await fetch(url, { method: "POST" });
        
        // als liken goed is gegaan...
        if(request.ok) {
            likeButton.dataset.liked = !isLiked;
            likeButton.removeAttribute("disabled");
        }
    });


    // share
    const shareData = {
        title: "funda",
        text: "Bekijk dit gave huis!",
        url: window.location.href,
    };

    const btn = document.querySelector(".share-btn");

    btn.addEventListener("click", async function () {
        if (navigator.share) {
            try {
                await navigator.share(shareData);
            } catch (err) {
                alert(`Error: ${err}`);
            }
        } else if(navigator.clipboard) {
            try {
                await navigator.clipboard.writeText(shareData.url);
            } catch(err) {
                alert(`Error: ${err}`);
            }
        } else {
            alert("Kan niet delen.");
            return;
        }
        

        const shareIcon = document.querySelector(".share-icon");
        const originalSVG = shareIcon.innerHTML;

        shareIcon.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="none" stroke="#0071B3" stroke-dasharray="24" stroke-dashoffset="24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 11l6 6l10 -10"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.4s" values="24;0"/></path></svg>`;

        setTimeout(() => {
            shareIcon.innerHTML = originalSVG;
        }, 2000);

    });

</script>